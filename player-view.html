<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hot Potato - My Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Balance Header */
        .balance-header {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            text-align: center;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .balance-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .coin-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .coin-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .coin-btn.buy {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .coin-btn.free {
            background: #2ecc71;
            color: white;
        }

        .coin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Farm Section */
        .farm-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .farm-section h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 16px;
        }

        .farm-display {
            background: linear-gradient(135deg, #8b4513, #654321);
            border-radius: 12px;
            padding: 20px;
            color: white;
        }

        .farm-status {
            font-size: 16px;
            margin-bottom: 12px;
            text-align: center;
        }

        .farm-progress-container {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            height: 40px;
            overflow: hidden;
            position: relative;
            margin-bottom: 12px;
        }

        .farm-progress-bar {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.5s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .farm-speed {
            font-size: 13px;
            opacity: 0.8;
            text-align: center;
        }

        /* Hand Slots */
        .slots-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .slots-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .slots-header h3 {
            font-size: 20px;
            color: #333;
        }

        .add-slot-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-slot-btn:hover {
            background: #5568d3;
        }

        .slots-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .slot {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .slot.has-potato {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: 2px solid #f39c12;
            padding: 12px;
        }

        .slot.frozen {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196f3;
        }

        .slot.locked {
            background: #e0e0e0;
            border: 2px solid #bdbdbd;
            cursor: pointer;
        }

        .slot.locked:hover {
            background: #d5d5d5;
        }

        .potato-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .potato-timer {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .potato-value {
            font-size: 14px;
            color: #e67e22;
            font-weight: 600;
        }

        .heat-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 20px;
        }

        .frozen-timer {
            font-size: 13px;
            color: #2196f3;
            font-weight: 600;
        }

        .lock-icon {
            font-size: 32px;
            opacity: 0.5;
            margin-bottom: 8px;
        }

        .unlock-text {
            font-size: 13px;
            color: #666;
        }

        .toss-buttons {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .toss-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 45%;
        }

        .toss-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        /* Store Section */
        .store-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .store-section h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 16px;
        }

        .potato-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .potato-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .potato-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .potato-info {
            flex: 1;
        }

        .potato-info h4 {
            font-size: 16px;
            color: #333;
            margin-bottom: 4px;
        }

        .potato-info p {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .buy-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .buy-btn:hover {
            transform: scale(1.05);
        }

        .buy-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }

        .empty-state h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 12px;
        }

        .empty-state p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .cta-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 300px;
            margin: 0 auto;
        }

        .cta-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cta-btn.primary {
            background: white;
            color: #667eea;
            border: 3px solid #667eea;
        }

        .cta-btn.secondary {
            background: #2ecc71;
            color: white;
        }

        .zkpassport-section {
            margin-top: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #667eea;
        }

        .zkpassport-section h4 {
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
        }

        .zkpassport-section p {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
        }

        .qr-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 12px;
        }

        .zkpassport-status {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }

        .privacy-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Show/Hide States */
        .show-when-empty {
            display: block;
        }

        .show-when-playing {
            display: none;
        }

        body.has-slots .show-when-empty {
            display: none;
        }

        body.has-slots .show-when-playing {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Balance Header -->
        <div class="balance-header">
            <div class="balance-amount" id="balance">0</div>
            <div class="balance-label">Potato Coins</div>
            <div class="coin-actions">
                <button class="coin-btn buy" onclick="buyCoins()">üí≥ Buy Coins</button>
                <button class="coin-btn free" onclick="getFreeCoins()">üéÅ Get Free Coins</button>
            </div>
        </div>

        <!-- Empty State (shown when no slots) -->
        <div class="empty-state show-when-empty">
            <h3>ü•î Ready to Play Hot Potato?</h3>
            <p>To start playing, you need at least one potato slot. You have two options:</p>
            <div class="cta-buttons">
                <button class="cta-btn primary" onclick="buySlot()">
                    Buy Your First Slot (5 PC)
                </button>
                <button class="cta-btn secondary" onclick="startZKPassportVerification()">
                    Verify Identity = FREE Slot + 10 PC
                </button>
            </div>

            <div class="zkpassport-section" id="zkpassport-section" style="display: none;">
                <div class="privacy-badge">üîí Privacy-Preserving Verification</div>
                <h4>Scan with ZKPassport App</h4>
                <p>Verify your identity without revealing personal data</p>
                <div class="qr-container" id="qr-container">
                    <!-- QR code will be generated here -->
                </div>
                <div class="zkpassport-status" id="zkpassport-status">Waiting for scan...</div>
            </div>

            <p style="margin-top: 20px; font-size: 14px;">
                üí° Need Potato Coins? Transfer crypto to your wallet or use the exchange above.
            </p>
        </div>

        <!-- Main Game Layout (shown when playing) -->
        <div class="main-layout show-when-playing">
            <div class="left-column">
                <!-- Farm Section -->
                <div class="farm-section">
                    <h3>üåæ Your Farm</h3>
                    <div class="farm-display">
                        <div class="farm-status">Next Potato</div>
                        <div class="farm-progress-container">
                            <div class="farm-progress-bar" id="farm-progress-bar" style="width: 0%;">
                                <span id="farm-timer">30s</span>
                            </div>
                        </div>
                        <div class="farm-speed">Base production speed</div>
                    </div>
                </div>

                <!-- Hand Slots -->
                <div class="slots-section">
                    <div class="slots-header">
                        <h3>Your Potato Slots</h3>
                        <button class="add-slot-btn" onclick="buySlot()">+ Add Slot (5 PC)</button>
                    </div>
                    <div class="slots-grid" id="slots-grid">
                        <!-- Slots will be dynamically generated -->
                    </div>
                </div>
            </div>

            <div class="right-column">
                <!-- Store Section -->
                <div class="store-section">
                    <h3>üè™ Potato Store</h3>
                    <div class="potato-list">
                        <div class="potato-item">
                            <div class="potato-info">
                                <h4>Golden Potato</h4>
                                <p>Earn PC equal to toss count. Heats 10% faster each toss.</p>
                            </div>
                            <button class="buy-btn" onclick="buyPotato('golden')">Buy 3 PC</button>
                        </div>
                        <div class="potato-item">
                            <div class="potato-info">
                                <h4>Home Fry Potato</h4>
                                <p>Gives 2 extra slots. Loses 10% value per toss. Burns hand 3 min.</p>
                            </div>
                            <button class="buy-btn" onclick="buyPotato('homefry')">Buy 8 PC</button>
                        </div>
                        <div class="potato-item">
                            <div class="potato-info">
                                <h4>BTC Potato</h4>
                                <p>Gains 20% value per toss. 30% fee to resend. Explodes: destroys random potato.</p>
                            </div>
                            <button class="buy-btn" onclick="buyPotato('btc')">Buy 5 PC</button>
                        </div>
                        <div class="potato-item">
                            <div class="potato-info">
                                <h4>Productivity Potato</h4>
                                <p>Doubles farm speed (stacks). 25% chance to steal recipient's next farm potato.</p>
                            </div>
                            <button class="buy-btn" onclick="buyPotato('productivity')" id="productivity-btn">Buy 8 PC</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        // Mock game state
        let gameState = {
            balance: 0,
            slots: [],
            hasFreSlot: false,
            farmNextProduction: null,
            farmInterval: 30000, // 30 seconds
            otherPlayers: ['Alice', 'Bob', 'Charlie'], // Mock other players
            zkPassportVerification: null
        };

        let farmTimer = null;
        let potatoTimers = null;

        // ZKPassport Integration
        // Note: This is a mock implementation for UI demonstration
        // In production, you would use: import { ZKPassport } from "@zkpassport/sdk"

        async function startZKPassportVerification() {
            const zkSection = document.getElementById('zkpassport-section');
            const statusEl = document.getElementById('zkpassport-status');
            const qrContainer = document.getElementById('qr-container');

            zkSection.style.display = 'block';

            // Mock ZKPassport initialization
            // In production:
            // const zkPassport = new ZKPassport();
            // const query = await zkPassport.request({
            //   name: "Hot Potato Game",
            //   logo: "https://joshuakrafchin.github.io/potatogame/logo.png",
            //   purpose: "Account verification for free game access"
            // });
            // const { url, requestId } = query.gte("age", 18).done();

            // Generate mock QR code URL for demonstration
            const mockRequestId = 'mock-' + Date.now();
            const mockUrl = `zkpassport://verify?app=hotpotato&request=${mockRequestId}`;

            // Generate QR code
            qrContainer.innerHTML = '';
            QRCode.toCanvas(mockUrl, { width: 200 }, function (error, canvas) {
                if (error) {
                    qrContainer.innerHTML = '<div style="padding: 40px; background: white;">QR Code Error</div>';
                } else {
                    qrContainer.appendChild(canvas);
                }
            });

            // Mock verification flow
            statusEl.textContent = 'Waiting for scan...';

            // Simulate user scanning and verifying
            setTimeout(() => {
                statusEl.textContent = 'QR Code scanned! Generating proof...';
            }, 2000);

            setTimeout(() => {
                statusEl.textContent = 'Proof generated! Verifying...';
            }, 4000);

            setTimeout(() => {
                statusEl.textContent = '‚úì Verification complete!';
                completeZKPassportVerification();
            }, 6000);
        }

        function completeZKPassportVerification() {
            // In production, this would be called after server-side verification
            gameState.balance = 10;
            gameState.hasFreSlot = true;
            gameState.slots.push({ locked: false, potato: null, frozen: false });
            gameState.zkPassportVerification = {
                verified: true,
                uniqueIdentifier: 'zk-' + Date.now(),
                timestamp: Date.now()
            };
            updateUI();
        }

        function updateFarmTimer() {
            if (!gameState.farmNextProduction) {
                gameState.farmNextProduction = Date.now() + gameState.farmInterval;
            }

            const now = Date.now();
            const remaining = Math.max(0, gameState.farmNextProduction - now);
            const seconds = Math.ceil(remaining / 1000);
            const progress = ((gameState.farmInterval - remaining) / gameState.farmInterval) * 100;

            document.getElementById('farm-timer').textContent = seconds + 's';
            document.getElementById('farm-progress-bar').style.width = progress + '%';

            if (remaining <= 0) {
                // Farm produced a potato!
                gameState.farmNextProduction = Date.now() + gameState.farmInterval;
                produceFarmPotato();
            }
        }

        function produceFarmPotato() {
            const emptySlot = gameState.slots.find(s => !s.potato && !s.frozen);
            if (!emptySlot) {
                // No alert, just skip
                return;
            }

            // Produce a random potato type
            const potatoTypes = [
                { name: 'Golden Potato', value: 3, heat: 0, burnTime: 20000 },
                { name: 'Home Fry Potato', value: 8, heat: 0, burnTime: 20000 },
                { name: 'BTC Potato', value: 5, heat: 0, burnTime: 20000 },
                { name: 'Basic Potato', value: 2, heat: 0, burnTime: 20000 }
            ];

            const randomPotato = potatoTypes[Math.floor(Math.random() * potatoTypes.length)];
            emptySlot.potato = {
                ...randomPotato,
                burnAt: Date.now() + randomPotato.burnTime
            };

            updateUI();
        }

        function updatePotatoTimers() {
            let needsUpdate = false;

            gameState.slots.forEach((slot, index) => {
                if (slot.potato && slot.potato.burnAt) {
                    const now = Date.now();
                    const remaining = Math.max(0, slot.potato.burnAt - now);
                    const seconds = Math.ceil(remaining / 1000);

                    if (remaining <= 0) {
                        // Potato burned!
                        slot.potato = null;
                        slot.frozen = true;
                        slot.frozenTime = '1m';
                        slot.frozenUntil = Date.now() + 60000; // 1 minute frozen
                        needsUpdate = true;
                    }
                }

                // Update frozen timers
                if (slot.frozen && slot.frozenUntil) {
                    const now = Date.now();
                    const remaining = Math.max(0, slot.frozenUntil - now);
                    const seconds = Math.ceil(remaining / 1000);
                    slot.frozenTime = seconds > 0 ? seconds + 's' : '0s';

                    if (remaining <= 0) {
                        slot.frozen = false;
                        slot.frozenTime = null;
                        slot.frozenUntil = null;
                        needsUpdate = true;
                    }
                }
            });

            if (needsUpdate) {
                updateUI();
            } else {
                // Just update the display without full re-render
                updatePotatoTimerDisplay();
            }
        }

        function updatePotatoTimerDisplay() {
            gameState.slots.forEach((slot, index) => {
                if (slot.potato && slot.potato.burnAt) {
                    const now = Date.now();
                    const remaining = Math.max(0, slot.potato.burnAt - now);
                    const seconds = Math.ceil(remaining / 1000);
                    const timerEl = document.getElementById(`potato-timer-${index}`);
                    if (timerEl) {
                        timerEl.textContent = `Burns in ${seconds}s`;
                    }
                }

                if (slot.frozen && slot.frozenUntil) {
                    const now = Date.now();
                    const remaining = Math.max(0, slot.frozenUntil - now);
                    const seconds = Math.ceil(remaining / 1000);
                    const frozenEl = document.getElementById(`frozen-timer-${index}`);
                    if (frozenEl) {
                        frozenEl.textContent = `Frozen: ${seconds}s`;
                    }
                }
            });
        }

        function startPotatoTimers() {
            if (potatoTimers) clearInterval(potatoTimers);
            potatoTimers = setInterval(updatePotatoTimers, 100);
        }

        function startFarmTimer() {
            if (farmTimer) clearInterval(farmTimer);
            gameState.farmNextProduction = Date.now() + gameState.farmInterval;
            farmTimer = setInterval(updateFarmTimer, 100);
        }

        function updateUI() {
            document.getElementById('balance').textContent = gameState.balance;

            // Update productivity potato price (50% of coins, min 8)
            const productivityPrice = Math.max(8, Math.ceil(gameState.balance * 0.5));
            document.getElementById('productivity-btn').textContent = `Buy ${productivityPrice} PC`;

            // Update slots display
            const slotsGrid = document.getElementById('slots-grid');
            slotsGrid.innerHTML = '';

            gameState.slots.forEach((slot, index) => {
                const slotDiv = document.createElement('div');

                if (slot.locked) {
                    slotDiv.className = 'slot locked';
                    slotDiv.innerHTML = `
                        <div class="lock-icon">üîí</div>
                        <div class="unlock-text">Click to unlock (5 PC)</div>
                    `;
                    slotDiv.onclick = () => buySlot();
                } else if (slot.frozen) {
                    slotDiv.className = 'slot frozen';
                    slotDiv.innerHTML = `
                        <div>‚ùÑÔ∏è</div>
                        <div class="frozen-timer" id="frozen-timer-${index}">Frozen: ${slot.frozenTime}</div>
                    `;
                } else if (slot.potato) {
                    slotDiv.className = 'slot has-potato';

                    const now = Date.now();
                    const remaining = Math.max(0, slot.potato.burnAt - now);
                    const seconds = Math.ceil(remaining / 1000);
                    const totalTime = slot.potato.burnTime || 20000;
                    const progress = (remaining / totalTime) * 100;
                    const heatIcon = progress < 33 ? 'üî•' : progress < 66 ? 'üå°Ô∏è' : '';

                    const tossButtons = gameState.otherPlayers.map(player =>
                        `<button class="toss-btn" onclick="tossPotato(${index}, '${player}')">‚Üí ${player}</button>`
                    ).join('');

                    slotDiv.innerHTML = `
                        ${heatIcon ? `<div class="heat-indicator">${heatIcon}</div>` : ''}
                        <div class="potato-name">${slot.potato.name}</div>
                        <div class="potato-timer" id="potato-timer-${index}">Burns in ${seconds}s</div>
                        <div class="potato-value">${slot.potato.value} PC</div>
                        <div class="toss-buttons">
                            ${tossButtons}
                        </div>
                    `;
                } else {
                    slotDiv.className = 'slot';
                    slotDiv.innerHTML = `<div style="opacity: 0.5;">Empty</div>`;
                }

                slotsGrid.appendChild(slotDiv);
            });

            // Show/hide sections
            if (gameState.slots.length > 0) {
                document.body.classList.add('has-slots');
                if (!farmTimer) {
                    startFarmTimer();
                }
                if (!potatoTimers) {
                    startPotatoTimers();
                }
            } else {
                document.body.classList.remove('has-slots');
                if (farmTimer) {
                    clearInterval(farmTimer);
                    farmTimer = null;
                }
                if (potatoTimers) {
                    clearInterval(potatoTimers);
                    potatoTimers = null;
                }
            }
        }

        function buySlot() {
            if (gameState.balance < 5) {
                return;
            }

            gameState.balance -= 5;
            gameState.slots.push({ locked: false, potato: null, frozen: false });
            updateUI();
        }


        function buyPotato(type) {
            const prices = {
                golden: 3,
                homefry: 8,
                btc: 5,
                productivity: Math.max(8, Math.ceil(gameState.balance * 0.5))
            };

            const price = prices[type];

            if (gameState.balance < price) {
                return;
            }

            const emptySlot = gameState.slots.find(s => !s.potato && !s.frozen);
            if (!emptySlot) {
                return;
            }

            gameState.balance -= price;
            emptySlot.potato = {
                name: type.charAt(0).toUpperCase() + type.slice(1) + ' Potato',
                value: price,
                heat: 0,
                burnTime: 20000,
                burnAt: Date.now() + 20000
            };

            updateUI();
        }

        function buyCoins() {
            // Modal would open here
        }

        function getFreeCoins() {
            // Modal would open here
        }

        function tossPotato(slotIndex, toPlayer) {
            const slot = gameState.slots[slotIndex];
            if (!slot || !slot.potato) return;

            slot.potato = null;
            updateUI();
        }

        // Initialize
        updateUI();
    </script>
</body>
</html>
